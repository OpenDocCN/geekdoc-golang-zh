# 库版本或依赖项的选择

> 原文：<https://golangbyexample.com/versiono-module-selection-go>

为了理解 GO 在选择在 `go.mod` 文件中指定了两个版本的库的版本时是如何处理的，我们必须首先理解语义版本化

语义版本控制由三部分组成，用点分隔。下面是版本控制的格式。

```go
v{major_version}.{minor_version}.{patch_version}
```

在哪里

*   `v`–这只是一个指标，说明它是一个版本

*   **main _ version**–表示库中不兼容的 API 变更。因此，当库中有不向后兼容的更改时，在这种情况下，major_version 会递增
*   **次要版本**–它以向后兼容的方式表示库的功能变化。因此，当库中有一些功能更改，但这些更改是向后兼容的，那么，在这种情况下，次要版本会递增

*   **patch _ version**–它以向后兼容的方式表示库中的 bug 修复。因此，当库的现有功能有 bug 修复时，那么，在这种情况下，patch_version 将递增。

现在在选择库的版本时可以有两种情况

*   使用同一个库的两个版本，仅在次要版本和补丁版本上有所不同。他们的主要版本是一样的。

*   使用相同库的两个版本，它们在专业上不同。

让我们看看在上面的两种情况下遵循什么方法

# **小版本或补丁版本不同**

Go 遵循最低版本策略方法，同时选择在 `go.mod` 文件中指定了两个版本的库版本，这两个版本仅在次要版本或补丁版本上有所不同。

例如，如果您使用同一个库的两个版本

```go
1.2.0
```

和

```go
1.3.0
```

那么 go 将选择 1.3.0，因为它是最新版本。

# **大版本不同**

Go 将主要版本视为不同的模块本身。这意味着什么？这实质上意味着导入路径将有一个主版本作为其后缀。让我们以任何 Golang 图书馆为例。咱们最新的语义版本是

```go
v8.2.3
```

那么 go.mod 文件将如下所示

```go
module github.com/sample/v8
go 1.11

..
```

它的导入路径中有主版本。所以任何使用 go-redis 的库都必须像这样导入它

```go
import "github.com/sample/v8"
```

如果将来发布了 `v9` 版本，则必须在应用中导入，如

```go
import "github.com/sample/v9"
```

此外，该库将改变其 go.mod 文件，以反映 v9 主版本

```go
module github.com/sample/v9
```

它本质上允许在同一个 go 应用中使用同一个库的不同主要版本。当在同一个应用中导入同一个库的不同主要版本时，我们也可以给出有意义的名称。例如

```go
import sample_v8 "github.com/sample/v8"
import sample_v9 "github.com/sample/v9"
```

这也称为**语义导入版本化**

还要注意的是

*   对于第一个版本，可以不在 go.mod 文件中指定版本。

*   此外，在导入同一库的不同主要版本时要小心。留意新版本可能提供的新功能。

同样出于同样的原因，当您使用

```go
go get -u
```

那么它将只升级到最新的次要版本或补丁版本，视情况而定。例如，假设应用使用的当前版本是

```go
v1.1.3
```

还假设我们有以下可用版本

```go
v1.2.0
v2.1.0
```

然后当我们跑的时候

```go
go get
```

那么它将更新为

```go
v1.2.0
```

原因是 go get 只会更新次要版本或补丁版本，而不会更新主要版本，因为 go 会将模块的主要版本视为完全不同的模块。

要升级主版本，请在 `go.mod` 文件中明确指定升级的依赖项，或者获取该版本。

此外，关于升级模块，需要注意几点

*   要仅将依赖项升级到其最新的修补程序版本，请使用以下命令

```go
go get -u=patch <dependency_name></dependency_name>
```

*   要将依赖项升级到特定版本，请使用以下命令

```go
go get [[email protected]](/cdn-cgi/l/email-protection)
```

*   要将依赖关系升级到特定的提交，请使用以下命令

```go
go get <dependency_name>@commit_number</dependency_name>
```

*   要将所有依赖项升级到最新的次要版本和修补程序版本，请使用以下命令

```go
go get ./...
```