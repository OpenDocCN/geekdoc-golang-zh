["```go\n[](#cb1-1)// begin a transaction\n[](#cb1-2)func (kv *KV) Begin(tx *KVTX)\n[](#cb1-3)// end a transaction: commit updates; rollback on error\n[](#cb1-4)func (kv *KV) Commit(tx *KVTX) error\n[](#cb1-5)// end a transaction: rollback\n[](#cb1-6)func (kv *KV) Abort(tx *KVTX)\n```", "```go\n[](#cb2-1)type KVTX struct {\n[](#cb2-2)    db   *KV\n[](#cb2-3)    meta []byte // for the rollback\n[](#cb2-4)}\n[](#cb2-5)\n[](#cb2-6)func (kv *KV) Begin(tx *KVTX) {\n[](#cb2-7)    tx.db = kv\n[](#cb2-8)    tx.meta = saveMeta(tx.db)\n[](#cb2-9)}\n[](#cb2-10)func (kv *KV) Commit(tx *KVTX) error {\n[](#cb2-11)    return updateOrRevert(tx.db, tx.meta)\n[](#cb2-12)}\n[](#cb2-13)func (kv *KV) Abort(tx *KVTX) {\n[](#cb2-14)    // nothing has written, just revert the in-memory states\n[](#cb2-15)    loadMeta(tx.db, tx.meta)\n[](#cb2-16)    // discard temporaries\n[](#cb2-17)    tx.db.page.nappend = 0\n[](#cb2-18)    tx.db.page.updates = map[uint64][]byte{}\n[](#cb2-19)}\n```", "```go\n[](#cb3-1)// previous chapter!!!\n[](#cb3-2)func (db *KV) Update(req *UpdateReq) (bool, error) {\n[](#cb3-3)    meta := saveMeta(db)\n[](#cb3-4)    if !db.tree.Update(req) {\n[](#cb3-5)        return false, nil\n[](#cb3-6)    }\n[](#cb3-7)    err := updateOrRevert(db, meta)\n[](#cb3-8)    return err == nil, err\n[](#cb3-9)}\n```", "```go\n[](#cb4-1)func (tx *KVTX) Seek(key []byte, cmp int) *BIter {\n[](#cb4-2)    return tx.db.tree.Seek(key, cmp)\n[](#cb4-3)}\n[](#cb4-4)func (tx *KVTX) Update(req *UpdateReq) bool {\n[](#cb4-5)    return tx.db.tree.Update(req)\n[](#cb4-6)}\n[](#cb4-7)func (tx *KVTX) Del(req *DeleteReq) bool {\n[](#cb4-8)    return tx.db.tree.Delete(req)\n[](#cb4-9)}\n```", "```go\n[](#cb5-1)type DBTX struct {\n[](#cb5-2)    kv KVTX\n[](#cb5-3)    db *DB\n[](#cb5-4)}\n[](#cb5-5)\n[](#cb5-6)func (db *DB) Begin(tx *DBTX)\n[](#cb5-7)func (db *DB) Commit(tx *DBTX) error\n[](#cb5-8)func (db *DB) Abort(tx *DBTX)\n```", "```go\n[](#cb6-1)func (tx *DBTX) Scan(table string, req *Scanner) error\n[](#cb6-2)func (tx *DBTX) Set(table string, rec Record, mode int) (bool, error)\n[](#cb6-3)func (tx *DBTX) Delete(table string, rec Record) (bool, error)\n```"]