<!--yml

分类：未分类

日期：2024-10-13 06:29:23

-->

# 在 Go (Golang) 中选择库或依赖项的版本。

> 来源：[`golangbyexample.com/versiono-module-selection-go/`](https://golangbyexample.com/versiono-module-selection-go/)

要理解 Go 在选择**go.mod**文件中指定的两个版本的库版本时的做法，我们首先要理解语义版本控制。

语义版本控制由三个部分组成，以点分隔。以下是版本控制的格式。

```go
v{major_version}.{minor_version}.{patch_version}
```

其中

+   **v** – 这只是一个指示符，表示这是一个版本。

+   **主要版本** – 它表示库中不兼容的 API 更改。因此，当库中有不向后兼容的更改时，此时主要版本会递增。

+   **次要版本** – 它表示库功能的变化是向后兼容的。因此，当库中有一些功能变化但这些变化是向后兼容时，此时次要版本会递增。

+   **补丁版本** – 它表示库中的错误修复是向后兼容的。因此，当库的现有功能有错误修复时，此时补丁版本会递增。

在选择库的版本时，可以有两种情况。

+   使用的同一个库的两个版本仅在次要和补丁版本上有所不同。它们的主要版本相同。

+   使用的同一个库的两个版本在主要版本上有所不同。

让我们看看 Go 在上述两种情况下遵循什么方法。

目录

**次要或补丁版本的差异**

+   主要版本的差异*  *# **次要或补丁版本的差异**

Go 在选择库版本时遵循最小版本策略，其中**go.mod**文件中指定的两个版本仅在次要或补丁版本上有所不同。

例如，如果你使用同一个库的两个版本，分别是

```go
1.2.0
```

和

```go
1.3.0
```

然后 Go 将选择 1.3.0，因为这是最新版本。

# **主要版本的差异**

Go 将主要版本视为不同的模块。这意味着什么呢？这基本上意味着导入路径将以主要版本作为后缀。让我们以任何 Go 库为例。假设最新的语义版本是

```go
v8.2.3
```

此时 go.mod 文件将如下所示。

```go
module github.com/sample/v8
go 1.11

..
```

它在导入路径中有主要版本。因此，任何使用 go-redis 的库都必须像这样导入。

```go
import "github.com/sample/v8"
```

如果将来发布**v9**版本，则必须在应用程序中像这样导入。

```go
import "github.com/sample/v9"
```

此外，库将更改其 go.mod 文件以反映 v9 主要版本。

```go
module github.com/sample/v9
```

这基本上允许在同一个 Go 应用程序中使用同一库的不同主要版本。我们也可以在同一个应用程序中导入同一库的不同主要版本时，给予有意义的名称。例如：

```go
import sample_v8 "github.com/sample/v8"
import sample_v9 "github.com/sample/v9"
```

这也被称为 **语义导入版本控制**。

还请注意：

+   对于第一个版本，可以不在 go.mod 文件中指定版本。

+   同时，在导入同一库的不同主要版本时要小心。留意可能与新版本一起提供的新功能。

由于同样的原因，当你使用以下命令更新特定模块时：

```go
go get -u
```

然后它将仅升级到最新的次要版本或补丁版本，具体取决于适用情况。例如，假设应用程序当前使用的版本是：

```go
v1.1.3
```

假设我们有以下可用版本：

```go
v1.2.0
v2.1.0
```

然后当我们运行：

```go
go get
```

然后它将更新为：

```go
v1.2.0
```

原因是因为 `go get` 只会更新次要或补丁版本，而不会更新主要版本，因为 Go 将模块的主要版本视为完全不同的模块。

要升级主要版本，请在 **go.mod** 文件中显式指定该升级的依赖项，或执行该版本的 `go get`。

另外，升级模块时需要注意几点：

+   要将依赖项升级到其最新的补丁版本，只需使用以下命令：

```go
go get -u=patch <dependency_name></dependency_name>
```

+   要将依赖项升级到特定版本，请使用以下命令：

```go
go get dependency@version
```

+   要将依赖项升级到特定的提交，请使用以下命令：

```go
go get <dependency_name>@commit_number</dependency_name>
```

+   要将所有依赖项升级到其最新的次要和补丁版本，请使用以下命令：

```go
go get ./...
```

+   [go](https://golangbyexample.com/tag/go/) *   [golang](https://golangbyexample.com/tag/golang/) *
