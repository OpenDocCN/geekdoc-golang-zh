<!--yml

类别：未分类

日期：2024-10-13 06:07:11

-->

# HTTP 客户端超时：所有主要类型的客户端超时

> 来源：[`golangbyexample.com/all-types-client-timeouts-http-tcp-udp-unix/`](https://golangbyexample.com/all-types-client-timeouts-http-tcp-udp-unix/)

目录

**   概述

+   拨号超时：

+   TLS 握手超时：

+   响应头超时：

+   请求超时：

+   套接字超时：

+   等待连接超时：

+   空闲连接超时：*  *# **概述**

在本文中，我们将研究在连接**客户端**与**服务器**时可能在 HTTP、TCP、UDP 或 Unix 套接字通信中出现的不同类型的超时。

还有一个称为**服务器超时**的概念，指定服务器何时可以关闭传入请求。补充一下，服务器超时存在是为了保护服务器免受恶意客户端或长时间保持连接的慢客户端的影响。

对于**客户端超时**，请注意，不同编程语言中的不同库可能无法为您提供设置以下描述的所有超时的选项。例如，在 Golang 的 net http 包中，Client 结构体（[`golang.org/pkg/net/http/#Client`](https://golang.org/pkg/net/http/#Client)）允许您设置单个**超时**。该超时指定以下两个超时。

1.  请求超时

1.  套接字超时

让我们了解所有类型的超时：

# **拨号超时**：

Dial Timeout 指定拨号在命名网络上完成连接所等待的最长时间。命名网络可以是**“TCP”，“UDP”，“IP”，“unix”**等。这是指从服务器完全没有响应的情况。可能发生的原因包括：

+   错误的 DNS

+   远程服务器没有响应

+   远程服务器已经挂掉

+   连接到远程服务器时使用了错误的端口

**示例**

假设 DialTimeout 为 1 秒。客户端正在拨打 TCP 连接，但在 1 秒内未收到来自服务器的任何响应，则会发生 DialTimeout。

# **TLS 握手超时**：

适用于 SSL 请求。每当与远程服务器建立连接时，会发生 TLS 握手，在此过程中交换 SSL 密钥并进行服务器的 SSL 证书验证。**TLS 握手** **超时**指定了等待 TLS 握手建立的最大时间。

**示例：**

假设一个 HTTP 请求的情况。假设 TLS 握手超时为 1 秒。客户端最多等待 1 秒以完成 TLS 握手。

# **响应头超时**：

在客户端与服务器完成 TLS 握手并完全发送请求头和请求体后，**响应头超时**就会生效。这个超时指定了等待接收服务器响应头的最长时间。

**示例：**

假设响应头超时是 1 秒。客户端发起 HTTP 请求，TLS 握手成功。然后客户端将请求头和请求体发送给服务器。在这种情况下，如果在 1 秒内没有接收到服务器的响应头，**响应头超时**将会发生。

# **请求超时：**

请求超时从拨号连接到服务器开始，到接收到远程服务器的整个响应体为止。它表示等待整个客户端请求完成的最长时间。想象一下一个 HTTP 请求，请求超时指定了它等待整个 HTTP 请求完成的最长时间。这是完整请求的超时，因此包括**拨号超时**、**TLS 握手超时**以及**响应头超时**，再加上等待响应体的额外时间。

**示例：**

假设你的请求超时是 1 秒，那么客户端将从拨号开始等待最长 1 秒以接收整个响应，之后会超时。

# **套接字超时：**

这个超时主要与长连接相关。与远程服务器建立了连接，并且也传输了一些字节。如果这段字节的数据流在特定时间内中断，那么套接字超时就会出现。

**示例：**

假设你的套接字超时时间是 1 秒，如果在接下来的 1 秒内没有新字节传输，那么将会导致套接字超时。将套接字超时时间设置为 1 秒意味着每秒应该接收到一些数据。因此，套接字超时是等待单个数据包，并不意味着等待完整响应的超时。

# **等待连接超时：**

这个超时适用于固定连接池。这是等待池中可用的活动连接的超时。

**示例**：

以数据库连接池为例。假设你正在使用 MYSQL 服务器，池中的最大连接数是 20，而所有连接目前都被使用。你的**“等待连接超时”**设置为 1 秒。新的请求到来，并需要一个连接来连接到数据库。由于所有 20 个连接都被占用，因此在这种情况下，新请求将最多等待 1 秒以获得可用连接，然后超时。在这种情况下，你可能会得到**“连接数过多”**的错误。

# **闲置连接超时：**

这个超时也适用于连接池。闲置连接超时指定了一个未使用连接应该保留的时间。

**示例：**

想象一个包含 20 个连接的连接池。在某个特定时刻，5 个连接正在并行使用。但之后，没有新的请求。因此，这 5 个连接将在“闲置连接超时”的值之前等待释放。闲置连接超时为 1 秒应该意味着某个连接不得闲置超过 1 秒，否则它将被释放，并为任何新请求创建一个新连接。
